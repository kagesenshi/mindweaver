apiVersion: v1
kind: Secret
metadata:
  name: {{ include "mindweaver.fullname" . }}-default-auth
  labels:
    {{- include "mindweaver.labels" . | nindent 4 }}
type: Opaque
data:
  {{- $auth := include "mindweaver.redisAuth" . | fromJson }}
  valkey-password: {{ $auth.password | b64enc | quote }}
  {{- if .Values.valkey.enabled }}
  MINDWEAVER_CELERY_BROKER_URL: {{ printf "redis://:%s@%s:%s/0" $auth.password $auth.host ($auth.port | toString) | b64enc | quote }}
  MINDWEAVER_CELERY_RESULT_BACKEND: {{ printf "redis://:%s@%s:%s/0" $auth.password $auth.host ($auth.port | toString) | b64enc | quote }}
  {{- end }}
